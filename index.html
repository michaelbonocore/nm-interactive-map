<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trail Camera Episode 3 - Northern New Mexico</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        /* Sidebar Styles */
        .sidebar {
            position: absolute;
            top: 10px;
            left: 55px;
            z-index: 1000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 280px;
            max-height: calc(100vh - 20px);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            max-width: 44px;
            max-height: 44px;
        }

        .sidebar-header {
            background: #E84C3D;
            color: white;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h1 {
            font-size: 13px;
            font-weight: 600;
            margin: 0;
            white-space: nowrap;
        }

        .sidebar-header .dates {
            font-size: 11px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .sidebar.collapsed .sidebar-header h1,
        .sidebar.collapsed .sidebar-header .dates {
            display: none;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-content {
            padding: 12px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
        }

        .sidebar.collapsed .sidebar-content {
            display: none;
        }

        .legend-section {
            margin-bottom: 15px;
        }

        .legend-section h3 {
            font-size: 11px;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 12px;
        }

        .legend-item:hover {
            background: #f5f5f5;
        }

        .legend-item.inactive {
            opacity: 0.4;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .legend-color.star {
            border-radius: 0;
            background: none !important;
            border: none;
            box-shadow: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .legend-label {
            flex: 1;
        }

        .legend-count {
            font-size: 10px;
            color: #999;
            margin-left: 5px;
        }

        .stats-section {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 6px;
            font-size: 11px;
            color: #666;
        }

        .stats-section div {
            margin: 3px 0;
        }

        .budget-total {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #ddd;
            font-weight: 600;
            color: #E84C3D;
        }

        /* Custom Markers */
        .custom-marker {
            background: white;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .marker-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .star-marker {
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .priority-badge {
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            background: #E84C3D;
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            white-space: nowrap;
            font-weight: bold;
        }

        .priority-badge.low {
            background: #888;
        }

        /* Popup Styles */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            padding: 0;
        }

        .leaflet-popup-content {
            margin: 0;
            max-width: 320px;
            min-width: 280px;
        }

        .popup-card {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .popup-header {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .popup-header h3 {
            font-size: 16px;
            margin: 0 0 4px 0;
            color: #333;
        }

        .popup-header .badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .popup-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            background: #f0f0f0;
        }

        .popup-badge.priority-high {
            background: #E84C3D;
            color: white;
        }

        .popup-badge.category {
            background: #e9ecef;
            color: #495057;
        }

        .popup-body {
            padding: 12px 15px;
        }

        .popup-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
        }

        .popup-meta div {
            margin: 4px 0;
            display: flex;
            align-items: flex-start;
        }

        .popup-meta .icon {
            width: 20px;
            flex-shrink: 0;
        }

        .popup-section {
            margin: 12px 0;
        }

        .popup-section h4 {
            font-size: 11px;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        .popup-section p {
            font-size: 13px;
            line-height: 1.5;
            color: #444;
            margin: 0;
        }

        .popup-links {
            display: flex;
            gap: 8px;
            padding: 12px 15px;
            border-top: 1px solid #eee;
            background: #fafafa;
        }

        .popup-link {
            flex: 1;
            text-align: center;
            padding: 8px 12px;
            background: #E84C3D;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .popup-link:hover {
            background: #c0392b;
        }

        /* Regional Overview Popup */
        .popup-header.regional {
            background: linear-gradient(135deg, #ffc107, #ffdb4d);
        }

        .popup-header.regional h3 {
            color: #333;
        }

        .popup-header.regional h3::before {
            content: '‚≠ê ';
        }

        /* Route Popup */
        .route-popup {
            padding: 12px;
        }

        .route-popup h3 {
            font-size: 14px;
            margin: 0 0 10px 0;
            color: #E84C3D;
        }

        .route-popup .route-details {
            font-size: 12px;
            color: #666;
        }

        .route-popup .route-details div {
            margin: 4px 0;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .sidebar {
                left: 10px;
                max-width: calc(100% - 70px);
            }

            .sidebar.collapsed {
                max-width: 44px;
            }

            .leaflet-popup-content {
                max-width: 280px;
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header" onclick="toggleSidebar()">
            <div>
                <h1>Trail Camera Ep. 3: N. New Mexico</h1>
                <div class="dates">March 15-23, 2026</div>
            </div>
            <button class="toggle-btn" id="toggleBtn">‚óÄ</button>
        </div>
        <div class="sidebar-content">
            <div class="legend-section">
                <h3>Categories</h3>
                <div id="categoryLegend"></div>
            </div>
            <div class="legend-section">
                <h3>Routes</h3>
                <div class="legend-item" id="routeToggle" onclick="toggleRoutes()">
                    <div class="legend-color" style="background: none; border: 2px dashed #E84C3D;"></div>
                    <span class="legend-label">Transportation</span>
                    <span class="legend-count">(3)</span>
                </div>
            </div>
            <div class="stats-section" id="statsSection">
                <div><strong>Total Locations:</strong> <span id="totalLocations">0</span></div>
                <div><strong>Regions:</strong> 2</div>
                <div><strong>Production Days:</strong> 9</div>
                <div class="budget-total"><strong>Est. Budget:</strong> $3,169</div>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // DATA
        // =====================================================

        const projectInfo = {
            title: "Trail Camera Episode 3 - Northern New Mexico",
            dateRange: "March 15-23, 2026",
            brandColor: "#E84C3D"
        };

        const categories = {
            "Staging/Logistics": { color: "#6c757d", description: "Lodging, airports, rental car locations" },
            "Landscape/Nature": { color: "#28a745", description: "Natural landmarks, viewpoints, outdoor shoots" },
            "Portrait/Interview": { color: "#6f42c1", description: "Locations for subject interviews" },
            "Food/Culture": { color: "#dc3545", description: "Restaurants, cultural experiences" },
            "Art/Cultural": { color: "#3388ff", description: "Museums, galleries, cultural centers" },
            "Architecture": { color: "#fd7e14", description: "Churches, historic structures" },
            "Regional Overview": { color: "#ffc107", icon: "star", description: "City/area summary markers" }
        };

        const categoryFilters = {};
        Object.keys(categories).forEach(cat => categoryFilters[cat] = true);

        let routesVisible = true;

        const regionalOverviews = [
            {
                name: "Santa Fe",
                coords: [35.6870, -105.9378],
                dateRange: "March 15-20, 2026",
                locationCount: 5,
                keyThemes: "Art colony legacy, creative interviews, High Road departure point",
                logistics: "Pueblo Courtyard Home (Cam Lado)",
                budget: "$1,578 lodging"
            },
            {
                name: "Taos",
                coords: [36.4072, -105.5731],
                dateRange: "March 20-23, 2026",
                locationCount: 4,
                keyThemes: "Rio Grande Gorge, Indigenous connection, alternative living",
                logistics: "13 Siah Moon house",
                budget: "$1,044 lodging"
            }
        ];

        const locations = [
            {
                name: "Santa Fe House (Pueblo Courtyard Home)",
                category: "Staging/Logistics",
                region: "Santa Fe",
                coords: [35.653026, -105.965688],
                dates: "March 15-20, 2026",
                bestTime: "N/A - Basecamp",
                admission: "$1,578 (5 nights)",
                permits: "No",
                keyFeatures: "3BR/2BA crew basecamp. Near Rail Trail. 4-person crew capacity. Free cancellation until Feb 13.",
                productionNotes: "Check-in 4:00 PM, Check-out 11:00 AM. Address: 2093 Cam Lado, Santa Fe, NM 87505.",
                googleMaps: "https://maps.google.com/?q=2093+Cam+Lado+Santa+Fe+NM+87505",
                priority: "High"
            },
            {
                name: "Taos House (Siah Moon)",
                category: "Staging/Logistics",
                region: "Taos",
                coords: [36.372171, -105.630102],
                dates: "March 20-23, 2026",
                bestTime: "N/A - Basecamp",
                admission: "$1,044 (3 nights)",
                permits: "No",
                keyFeatures: "3BR/2BA crew basecamp in Ranchos de Taos. Built 2023. Close to Rio Grande Gorge and Earthships.",
                productionNotes: "Address: 13 Siah Moon, Ranchos de Taos, NM 87557. Directions: South on NM-68 from Taos Plaza, west on NM-240, left on Tom Holder Rd, right on Cuchilla Rd, left on Siah Moon.",
                googleMaps: "https://maps.google.com/?q=13+Siah+Moon+Ranchos+de+Taos+NM+87557",
                priority: "High"
            }
        ];

        const transportationRoutes = [
            {
                from: "Albuquerque (ABQ Airport)",
                to: "Santa Fe House",
                fromCoords: [35.0402, -106.6504],
                toCoords: [35.653026, -105.965688],
                date: "March 15, 2026",
                mode: "Rental Car (Chevy Tahoe)",
                duration: "1 hour",
                cost: "$547 (8-day rental)",
                departureTime: "9:36 AM (after landing)",
                booking: "carrentals.com - BOOKED",
                notes: "Michael arrives ABQ, picks up Tahoe, drives I-25 North to Santa Fe."
            },
            {
                from: "Santa Fe House",
                to: "Taos House",
                fromCoords: [35.653026, -105.965688],
                toCoords: [36.372171, -105.630102],
                date: "March 20, 2026",
                mode: "Rental Car (High Road)",
                duration: "2.5 hours (with filming stops)",
                cost: "Included in rental",
                departureTime: "11:00 AM (after checkout)",
                booking: "N/A",
                notes: "High Road to Taos via Chimayo, Las Trampas, Truchas. Filming stops along the way."
            },
            {
                from: "Taos House",
                to: "Santa Fe Airport (SAF)",
                fromCoords: [36.372171, -105.630102],
                toCoords: [35.617, -106.089],
                date: "March 23, 2026",
                mode: "Rental Car",
                duration: "1.5 hours",
                cost: "Included in rental",
                departureTime: "12:00 PM",
                booking: "N/A",
                notes: "Drop crew at SAF by 2:30 PM for 3:20 PM flight. Michael continues to ABQ."
            }
        ];

        // =====================================================
        // MAP INITIALIZATION
        // =====================================================

        const map = L.map('map', {
            zoomControl: true
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Layer groups for filtering
        const markerLayers = {};
        Object.keys(categories).forEach(cat => {
            markerLayers[cat] = L.layerGroup().addTo(map);
        });
        const routeLayer = L.layerGroup().addTo(map);

        // =====================================================
        // MARKER CREATION FUNCTIONS
        // =====================================================

        function createMarkerIcon(category, location) {
            const cat = categories[category];
            const isRegional = category === "Regional Overview";
            const size = isRegional ? 36 : 24;

            let priorityBadge = '';
            if (location && location.priority) {
                const isHigh = location.priority === "High";
                priorityBadge = `<span class="priority-badge ${isHigh ? '' : 'low'}">${isHigh ? 'HIGH' : 'LOW'}</span>`;
            }

            const html = isRegional
                ? `<div class="star-marker" style="color: ${cat.color};">‚òÖ</div>`
                : `<div class="custom-marker" style="width: ${size}px; height: ${size}px;">
                     <div class="marker-inner" style="background: ${cat.color};"></div>
                   </div>${priorityBadge}`;

            return L.divIcon({
                html: html,
                className: '',
                iconSize: [size, size],
                iconAnchor: [size/2, size/2],
                popupAnchor: [0, -size/2]
            });
        }

        function createLocationPopup(loc) {
            const badges = [];
            if (loc.priority === "High") badges.push('<span class="popup-badge priority-high">HIGH PRIORITY</span>');
            badges.push(`<span class="popup-badge category">${loc.category}</span>`);

            const linksHtml = loc.googleMaps
                ? `<div class="popup-links">
                     <a href="${loc.googleMaps}" target="_blank" class="popup-link">Open in Google Maps</a>
                   </div>`
                : '';

            return `
                <div class="popup-card">
                    <div class="popup-header">
                        <h3>${loc.name}</h3>
                        ${badges.length ? `<div class="badges">${badges.join('')}</div>` : ''}
                    </div>
                    <div class="popup-body">
                        <div class="popup-meta">
                            <div><span class="icon">üìç</span> <strong>Region:</strong> ${loc.region}</div>
                            <div><span class="icon">üìÖ</span> <strong>Dates:</strong> ${loc.dates}</div>
                            <div><span class="icon">üïê</span> <strong>Best Time:</strong> ${loc.bestTime}</div>
                            <div><span class="icon">üí∞</span> <strong>Cost:</strong> ${loc.admission}</div>
                            <div><span class="icon">üìã</span> <strong>Permits:</strong> ${loc.permits}</div>
                        </div>
                        <div class="popup-section">
                            <h4>Key Features</h4>
                            <p>${loc.keyFeatures}</p>
                        </div>
                        <div class="popup-section">
                            <h4>Production Notes</h4>
                            <p>${loc.productionNotes}</p>
                        </div>
                    </div>
                    ${linksHtml}
                </div>
            `;
        }

        function createRegionalPopup(region) {
            return `
                <div class="popup-card">
                    <div class="popup-header regional">
                        <h3>${region.name} Overview</h3>
                    </div>
                    <div class="popup-body">
                        <div class="popup-meta">
                            <div><span class="icon">üìÖ</span> <strong>Date Range:</strong> ${region.dateRange}</div>
                            <div><span class="icon">üìç</span> <strong>Locations:</strong> ${region.locationCount} filming spots</div>
                            <div><span class="icon">üí∞</span> <strong>Budget:</strong> ${region.budget}</div>
                        </div>
                        <div class="popup-section">
                            <h4>Key Themes</h4>
                            <p>${region.keyThemes}</p>
                        </div>
                        <div class="popup-section">
                            <h4>Logistics Hub</h4>
                            <p>${region.logistics}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function createRoutePopup(route) {
            return `
                <div class="route-popup">
                    <h3>${route.from} ‚Üí ${route.to}</h3>
                    <div class="route-details">
                        <div>üìÖ <strong>Date:</strong> ${route.date}</div>
                        <div>üöó <strong>Mode:</strong> ${route.mode}</div>
                        <div>‚è±Ô∏è <strong>Duration:</strong> ${route.duration}</div>
                        <div>üí∞ <strong>Cost:</strong> ${route.cost}</div>
                        <div>üïê <strong>Departure:</strong> ${route.departureTime}</div>
                        <div>üìã <strong>Booking:</strong> ${route.booking}</div>
                        <div style="margin-top: 8px;"><strong>Notes:</strong> ${route.notes}</div>
                    </div>
                </div>
            `;
        }

        // =====================================================
        // ADD MARKERS AND ROUTES
        // =====================================================

        // Add regional overview markers
        regionalOverviews.forEach(region => {
            const marker = L.marker(region.coords, {
                icon: createMarkerIcon("Regional Overview", null)
            });
            marker.bindPopup(createRegionalPopup(region), { maxWidth: 350 });
            marker.addTo(markerLayers["Regional Overview"]);
        });

        // Add location markers
        locations.forEach(loc => {
            const marker = L.marker(loc.coords, {
                icon: createMarkerIcon(loc.category, loc)
            });
            marker.bindPopup(createLocationPopup(loc), { maxWidth: 350 });
            marker.addTo(markerLayers[loc.category]);
        });

        // Add transportation routes
        transportationRoutes.forEach(route => {
            const polyline = L.polyline([route.fromCoords, route.toCoords], {
                color: '#E84C3D',
                weight: 3,
                opacity: 0.7,
                dashArray: '10, 10'
            });
            polyline.bindPopup(createRoutePopup(route), { maxWidth: 300 });
            polyline.addTo(routeLayer);
        });

        // Fit map to show both Santa Fe and Taos
        const allCoords = [
            ...regionalOverviews.map(r => r.coords),
            ...locations.map(l => l.coords),
            [35.0402, -106.6504] // ABQ Airport
        ];
        const bounds = L.latLngBounds(allCoords);
        map.fitBounds(bounds, { padding: [50, 50] });

        // =====================================================
        // SIDEBAR AND LEGEND
        // =====================================================

        function buildLegend() {
            const legendContainer = document.getElementById('categoryLegend');
            legendContainer.innerHTML = '';

            Object.entries(categories).forEach(([name, cat]) => {
                const count = name === "Regional Overview"
                    ? regionalOverviews.length
                    : locations.filter(l => l.category === name).length;

                // Skip categories with no locations (except Regional Overview)
                if (count === 0 && name !== "Regional Overview") return;

                const item = document.createElement('div');
                item.className = `legend-item ${categoryFilters[name] ? '' : 'inactive'}`;
                item.onclick = () => toggleCategory(name);

                const colorClass = cat.icon === "star" ? "star" : "";
                const colorContent = cat.icon === "star"
                    ? `<span style="color: ${cat.color};">‚òÖ</span>`
                    : '';

                item.innerHTML = `
                    <div class="legend-color ${colorClass}" style="background: ${cat.icon === "star" ? 'none' : cat.color};">${colorContent}</div>
                    <span class="legend-label">${name}</span>
                    <span class="legend-count">(${count})</span>
                `;
                legendContainer.appendChild(item);
            });
        }

        function toggleCategory(category) {
            categoryFilters[category] = !categoryFilters[category];

            if (categoryFilters[category]) {
                map.addLayer(markerLayers[category]);
            } else {
                map.removeLayer(markerLayers[category]);
            }

            buildLegend();
        }

        function toggleRoutes() {
            routesVisible = !routesVisible;
            const routeToggle = document.getElementById('routeToggle');

            if (routesVisible) {
                map.addLayer(routeLayer);
                routeToggle.classList.remove('inactive');
            } else {
                map.removeLayer(routeLayer);
                routeToggle.classList.add('inactive');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const btn = document.getElementById('toggleBtn');
            sidebar.classList.toggle('collapsed');
            btn.textContent = sidebar.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
        }

        function updateStats() {
            document.getElementById('totalLocations').textContent = locations.length + regionalOverviews.length;
        }

        // Initialize
        buildLegend();
        updateStats();

        // Auto-collapse sidebar on mobile
        if (window.innerWidth < 768) {
            toggleSidebar();
        }
    </script>
</body>
</html>
